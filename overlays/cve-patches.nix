# overlays/cve-patches.nix
# CVE patches for Critical/High vulnerabilities
# Remove patches once upstream catches up
final: prev: {
  # Busybox 1.37.0 to fix CVEs now included upstream:
  # - CVE-2022-28391: sockaddr2str/nslookup printable character sanitization
  # - CVE-2022-48174 (CRITICAL): shell segfault on malformed input
  # - CVE-2023-42363, CVE-2023-42364, CVE-2023-42365, CVE-2023-42366: awk fixes
  # - tar TOCTOU symlink race condition
  #
  # The nixpkgs busybox 1.36.1 has backported patches, but scanners flag
  # based on version number. 1.37.0 includes all fixes upstream.
  #
  # Remove once nixpkgs-unstable updates busybox to >= 1.37.0.
  # PR merged to staging: https://github.com/NixOS/nixpkgs/pull/469979
  # Status: In master, waiting for propagation to nixpkgs-unstable
  busybox = final.callPackage ./busybox-patched/package.nix { };
}
